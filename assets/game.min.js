!function(){var e=function(e,t){var i=function(e,t){return t||(t=document),t.querySelector(e)},A=function(){var e=(new Date).getTime()/1e3,t=parseInt(e,10);return Math.round(1e3*(e-t))/1e3+t};!function(){for(var e=0,t=["ms","moz","webkit","o"],i=0;i<t.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[t[i]+"requestAnimationFrame"],window.cancelAnimationFrame=window[t[i]+"CancelAnimationFrame"]||window[t[i]+"CancelrequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,i){var n=(new Date).getTime(),A=Math.max(0,16-(n-e)),s=window.setTimeout(function(){t(n+A)},A);return e=n+A,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}();var s,r,a,o,h,d,u,p,w=i("#"+e),m=t,x=33,y=0,g=[new Audio("assets/audio/1.wav"),new Audio("assets/audio/2.wav"),new Audio("assets/audio/3.wav"),new Audio("assets/audio/4.wav")],f=new Audio("assets/audio/ufo.wav"),v=new Audio("assets/audio/crash.wav"),k=new Audio("assets/audio/fire.wav"),S=new Audio("assets/audio/bang.wav"),B="data:image/png;base64,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",T={alien_1:{id:"alien_1",width:32,height:32,tiles:[{x:4,y:4},{x:40,y:4}]},alien_2:{id:"alien_2",width:44,height:32,tiles:[{x:4,y:40},{x:56,y:40}]},alien_3:{id:"alien_3",width:48,height:32,tiles:[{x:4,y:76},{x:60,y:76}]},flyingSaucer:{id:"flyingSaucer",width:48,height:28,tiles:[{x:4,y:128}]},cannon:{id:"cannon",width:52,height:32,tiles:[{x:4,y:160},{x:60,y:160}]},cannonBullet:{id:"cannonBullet",width:4,height:28,tiles:[{x:4,y:200}]},alienBullet:{id:"alienBullet",width:12,height:28,tiles:[{x:12,y:200}]},alienExplosion:{id:"alienExplosion",width:52,height:28,tiles:[{x:32,y:200}]},saucerExplosion:{id:"saucerExplosion",width:52,height:28,tiles:[{x:88,y:200}]},bunkerFull:{id:"bunkerFull",width:24,height:24,tiles:[{x:4,y:232},{x:32,y:232},{x:60,y:232},{x:88,y:232}]},bunkerTopLeft:{id:"bunkerTopLeft",width:24,height:24,tiles:[{x:4,y:260},{x:32,y:260},{x:60,y:260},{x:88,y:260}]},bunkerTopRight:{id:"bunkerTopRight",width:24,height:24,tiles:[{x:4,y:288},{x:32,y:288},{x:60,y:288},{x:88,y:288}]},bunkerBottomLeft:{id:"bunkerBottomLeft",width:24,height:24,tiles:[{x:4,y:316},{x:32,y:316},{x:60,y:316},{x:88,y:316}]},bunkerBottomRight:{id:"bunkerBottomRight",width:24,height:24,tiles:[{x:4,y:344},{x:32,y:344},{x:60,y:344},{x:88,y:344}]},bunkerFullSmall:{id:"bunkerFullSmall",width:18,height:18,tiles:[{x:4,y:372},{x:22,y:372},{x:44,y:372},{x:66,y:372}]},scoreAdv:{id:"scoreAdv",width:140,height:28,tiles:[{x:4,y:400}]}},F=function(e){this.typeOf="sprite",this.sprite=e.sprite,this.tileId=0,this.x=e.x,this.y=e.y,this.scale=e.scale||1},C=function(e){for(var t in this.base=new F(e),this.base)this[t]=this.base[t];this.typeOf="ship",this.points=e.points,this.state="alive",this.collide=function(e){return"alive"==this.state&&e.y>=this.y&&e.y<=this.y+this.sprite.height&&e.x>=this.x&&e.x<=this.x+this.sprite.width},this.touchBorder=function(){return Y.alienSpeedX>0?this.x+Y.alienSquareWidth+5>=r.width:this.x-(Y.alienSquareWidth-this.sprite.width)/2<=0},this.setSprite=function(e){this.sprite=e},this.setState=function(e){this.state=e}},_=function(e){for(var t in this.base=new C(e),this.base)"base"!=t&&(this[t]=this.base[t]);this.typeOf="flyingSaucerShip"},I=function(e){for(var t in this.base=new F(e),this.base)this[t]=this.base[t];this.typeOf="bullet",this.collide=function(e){return this.y+this.sprite.height>=e.y&&this.y<=e.y&&this.x+this.sprite.width>=e.x&&this.x<=e.x+e.sprite.width||"alive"==e.state&&this.y<=e.y+e.sprite.height&&this.y>=e.y&&this.x+this.sprite.width>=e.x&&this.x<=e.x+e.sprite.width}},L=function(e){this.typeOf="bunker",this.x=e.x,this.y=e.y,this.blocks=[new F({sprite:T.bunkerTopLeft,x:this.x,y:this.y}),new F({sprite:T.bunkerFull,x:this.x+T.bunkerFull.width,y:this.y}),new F({sprite:T.bunkerFull,x:this.x+2*T.bunkerFull.width,y:this.y}),new F({sprite:T.bunkerTopRight,x:this.x+3*T.bunkerFull.width,y:this.y}),new F({sprite:T.bunkerFull,x:this.x,y:this.y+T.bunkerFull.height}),new F({sprite:T.bunkerBottomRight,x:this.x+T.bunkerFull.width,y:this.y+T.bunkerFull.height}),new F({sprite:T.bunkerBottomLeft,x:this.x+2*T.bunkerFull.width,y:this.y+T.bunkerFull.height}),new F({sprite:T.bunkerFull,x:this.x+3*T.bunkerFull.width,y:this.y+T.bunkerFull.height}),new F({sprite:T.bunkerFull,x:this.x,y:this.y+2*T.bunkerFull.height}),new F({sprite:T.bunkerFull,x:this.x+3*T.bunkerFull.width,y:this.y+2*T.bunkerFull.height})]},E=function(e){this.typeOf="ADV",this.x=e.x,this.y=e.y,this.scale=1,this.letter=e.letter,this.blocks=[];var t=0,i=0,A=0;for(i=0,l=this.letter.length;i<l;i++)for(t=this.letter[i],A=0,n=t.length;A<n;A++)0==parseInt(t[A])&&this.blocks.push(new F({sprite:T.bunkerFullSmall,x:this.x+A*T.bunkerFullSmall.width,y:this.y+i*T.bunkerFullSmall.height}))},D={stars:[],starsLayer:2,k_star_number:10,init:function(){var e,t;if(!("ontouchstart"in window))for(this.stars=[],e=0;e<this.starsLayer;e++)for(this.stars.push([]),t=0;t<this.k_star_number;t++)this.stars[e].push([Math.random()*r.width,Math.random()*r.height,Math.random()*(2*e+3),Math.random()/2,2*e+3,2*e+3-2])},drawStars:function(){var e,t,i,n,A,s,l,o,h;for(o=0,nl=this.stars.length;o<nl;o++)for(h=0,il=this.stars[o].length;h<il;h++)t=(e=this.stars[o][h])[0],i=e[1],n=e[2],A=e[3],s=e[4],l=e[5],a.fillStyle="rgba(255, 255, 255, "+A+")",a.beginPath(),a.arc(t,i,n,0,2*Math.PI,!0),a.closePath(),a.fill(),t-n<0?(e[0]=r.width-n,e[2]=Math.random()*s,e[1]=Math.random()*r.height,e[3]=Math.random()/2):e[0]-=l}},Y={flyingSaucer:null,alienBullet:null,flyingSaucerTimer:null,arrAliens:null,alienBorderCollision:null,alienBulletSpeed:10,nAlienRows:5,nAliensByRow:11,alienSquareWidth:60,alienSquareHeight:40,alienSpeedX:10,alienSpeedY:40,alienInitialY:180,flyingSaucerInitialY:120,flyingSaucerSpeed:4,init:function(){var e,t;this.alienBorderCollision=!0,this.flyingSaucer=null,this.flyingSaucerTimer=(new Date).getTime(),this.alienBullet=null,this.arrAliens=[],this.alienSpeedX=10;for(var i=0;i<this.nAlienRows;i++){0==i&&(e=T.alien_1,t=30),i>0&&i<3&&(e=T.alien_2,t=20),i>2&&i<5&&(e=T.alien_3,t=10);for(var n=0;n<this.nAliensByRow;n++)this.arrAliens.push(new C({sprite:e,x:n*this.alienSquareWidth+(this.alienSquareWidth-e.width)/2,y:i*this.alienSquareHeight+this.alienInitialY,points:t}))}},updateAliens:function(){var e;++y>3&&(y=0),g[y].play();for(var t={x:0,y:0,tile:1},i=this.alienSpeedX,n=0,A=0;A<this.arrAliens.length;A++)if("striked"!=(e=this.arrAliens[A]).state){if(e.touchBorder()&&!this.alienBorderCollision){this.alienBorderCollision=!this.alienBorderCollision,i=0,n=this.alienSpeedY,this.alienSpeedX*=-1;break}e.y+e.sprite.height>=R.cannon.y&&(h=!0)}else this.arrAliens.splice(A,1),A=0;return 0!=i&&(this.alienBorderCollision=!this.alienBorderCollision),t.x=i,t.y=n,t},drawAlienShips:function(e){for(var t,i=0;i<this.arrAliens.length;i++)"striked"==(t=this.arrAliens[i]).state&&t.setSprite(T.alienExplosion),t.x+=e.x,t.y+=e.y,t.tileId+=e.tile,t.tileId>=t.sprite.tiles.length&&(t.tileId=0),a.drawImage(s,t.sprite.tiles[t.tileId].x,t.sprite.tiles[t.tileId].y,t.sprite.width,t.sprite.height,t.x,t.y,t.sprite.width,t.sprite.height);0==this.arrAliens.length&&(x=Math.floor(.8*x),Y.init())},updateFlyingSaucer:function(){return this.flyingSaucer&&"striked"==this.flyingSaucer.state},drawFlyingSaucer:function(e){var t=(new Date).getTime();this.flyingSaucer?("striked"==this.flyingSaucer.state&&(this.flyingSaucer.sprite=T.saucerExplosion),this.flyingSaucer.x<=-T.flyingSaucer.width||e?(this.flyingSaucer=null,this.flyingSaucerTimer=t):(f.play(),this.flyingSaucer.x-=this.flyingSaucerSpeed,a.drawImage(s,this.flyingSaucer.sprite.tiles[0].x,this.flyingSaucer.sprite.tiles[0].y,this.flyingSaucer.sprite.width,this.flyingSaucer.sprite.height,this.flyingSaucer.x,this.flyingSaucer.y,this.flyingSaucer.sprite.width,this.flyingSaucer.sprite.height))):t-this.flyingSaucerTimer>=1e4&&(this.flyingSaucer=new _({sprite:T.flyingSaucer,x:r.width,y:this.flyingSaucerInitialY,points:100}))},drawAliens:function(){var e,t={x:0,y:0,tile:0};o==x?(t=this.updateAliens(),e=this.updateFlyingSaucer(),o=0):o++,this.drawAlienShips(t),this.drawFlyingSaucer(e)},drawAlienBullet:function(){if(this.alienBullet){var e=!0;if(this.alienBullet.y+=this.alienBulletSpeed,this.alienBullet.y>=r.height&&(e=!1),e&&!u&&this.alienBullet.collide(R.cannon)&&(u=!0,p=A(),v.play(),O.nLives--,0==O.nLives&&R.cannon.tileId++,e=!1),e)for(var t,i,n=0,l=N.arrBunker.length;n<l;n++)for(var o=0,h=(t=N.arrBunker[n]).blocks.length;o<h;o++)if(i=t.blocks[o],this.alienBullet.collide(i)){i.tileId++,i.tileId>=i.sprite.tiles.length&&t.blocks.splice(o,1),e=!1;break}if(e&&this.alienBullet.y+this.alienBullet.sprite.height>=O.lineY)O.lineInterrupts.join().indexOf(this.alienBullet.x.toString())<0&&O.lineInterrupts.push(this.alienBullet.x);e?a.drawImage(s,this.alienBullet.sprite.tiles[0].x,this.alienBullet.sprite.tiles[0].y,this.alienBullet.sprite.width,this.alienBullet.sprite.height,this.alienBullet.x,this.alienBullet.y,this.alienBullet.sprite.width,this.alienBullet.sprite.height):this.alienBullet=null}else{var d=Math.floor((this.arrAliens.length+1)*Math.random());this.arrAliens[d]&&(this.alienBullet=new I({sprite:T.alienBullet,x:this.arrAliens[d].x+this.arrAliens[d].sprite.width/2,y:this.arrAliens[d].y}))}}},R={cannon:null,cannonBullet:null,moveCannon:null,cannonFire:null,cannonSpeed:8,cannonBulletSpeed:10,score:0,init:function(){this.moveCannon="N",this.cannonFire=!1,this.cannonBullet=null,this.score=0,this.cannon=new C({sprite:T.cannon,x:r.width/2-T.cannon.width/2,y:r.height-55-T.cannon.height})},updateScore:function(e){this.score+=e},drawCannon:function(){if(!h)switch(this.moveCannon){case"L":this.cannon.x>=0&&(this.cannon.x+=-this.cannonSpeed);break;case"R":this.cannon.x<=r.width-this.cannon.sprite.width&&(this.cannon.x+=this.cannonSpeed);break;default:this.cannon.x+=0}this.cannon.y=r.height-55-T.cannon.height,h||u?(a.drawImage(s,this.cannon.sprite.tiles[1].x,this.cannon.sprite.tiles[1].y,this.cannon.sprite.width,this.cannon.sprite.height,this.cannon.x,this.cannon.y,this.cannon.sprite.width,this.cannon.sprite.height),u&&!h&&A()-p>1&&(u=!1)):a.drawImage(s,this.cannon.sprite.tiles[0].x,this.cannon.sprite.tiles[0].y,this.cannon.sprite.width,this.cannon.sprite.height,this.cannon.x,this.cannon.y,this.cannon.sprite.width,this.cannon.sprite.height)},drawCannonBullet:function(){if(this.cannonBullet){var e=!0;if(this.cannonBullet.y-=this.cannonBulletSpeed,this.cannonBullet.y<=0&&(e=!1),e&&Y.alienBullet&&this.cannonBullet.collide(Y.alienBullet)&&(Y.alienBullet=null,e=!1),e&&Y.flyingSaucer&&this.cannonBullet.collide(Y.flyingSaucer)&&(S.play(),Y.flyingSaucer.setState("striked"),this.updateScore(Y.flyingSaucer.points),e=!1),e)for(var t,i=0;i<Y.arrAliens.length;i++)if(t=Y.arrAliens[i],this.cannonBullet.collide(t)){S.play(),t.setState("striked"),this.updateScore(t.points),e=!1;break}if(e){i=0;for(var n=N.arrBunker.length;i<n;i++)for(var A=0,r=(l=N.arrBunker[i]).blocks.length;A<r;A++)if(o=l.blocks[A],this.cannonBullet.collide(o)){o.tileId++,o.tileId>=o.sprite.tiles.length&&l.blocks.splice(A,1),e=!1;break}}if(e){var l,o;for(i=0,n=M.arrAdv.length;i<n;i++)for(A=0,r=(l=M.arrAdv[i]).blocks.length;A<r;A++)if(o=l.blocks[A],this.cannonBullet.collide(o)){o.tileId++,o.tileId>=o.sprite.tiles.length&&l.blocks.splice(A,1),e=!1;break}}e?a.drawImage(s,this.cannonBullet.sprite.tiles[0].x,this.cannonBullet.sprite.tiles[0].y,this.cannonBullet.sprite.width,this.cannonBullet.sprite.height,this.cannonBullet.x,this.cannonBullet.y,this.cannonBullet.sprite.width,this.cannonBullet.sprite.height):this.cannonBullet=null}else this.cannonFire&&(h||u||(k.play(),this.cannonBullet=new I({sprite:T.cannonBullet,x:this.cannon.x+this.cannon.sprite.width/2-T.cannonBullet.width/2,y:this.cannon.y})))}},M={arrAdv:[],distance:0,advFrameCounter:0,adv_letters:[[[0,0,0,0,0,0,0],[0,0,1,1,1,0,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,1,1,1,1,0],[0,1,0,0,0,1,0],[0,0,0,0,0,0,0]],[[1,1,1,1,1,1,1],[1,0,0,0,1,1,1],[1,1,0,1,1,1,1],[1,1,0,1,1,1,1],[1,1,0,1,1,0,1],[1,0,0,0,0,0,1],[1,1,1,1,1,1,1]],[[0,0,0,0,0,0,0],[0,0,1,1,1,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,1,1,1,0,0],[0,0,0,0,0,0,0]],[[1,1,1,1,1,1,1],[1,0,0,0,0,0,1],[1,0,1,1,1,1,1],[1,0,0,0,0,1,1],[1,0,1,1,1,1,1],[1,0,0,0,0,0,1],[1,1,1,1,1,1,1]],[[0,0,0,0,0,0,0],[0,1,0,0,0,1,0],[0,1,1,0,0,1,0],[0,1,0,1,0,1,0],[0,1,0,0,1,1,0],[0,1,0,0,0,1,0],[0,0,0,0,0,0,0]]],moveX:15,moveY:5,marginTop:-126,updateAdvFrameCounter:21,shakeAdv:150,init:function(){var e,t,i=this.adv_letters.length;this.arrAdv=[],this.moveX=15,this.moveY=5,this.advFrameCounter=0,this.updateAdvFrameCounter=21,M.shakeAdv=150;for(var n=0;n<i;n++)e=r.width/2-(1*T.bunkerFullSmall.width*7*i+this.distance*i)/2+n*(1*T.bunkerFullSmall.width*7+this.distance),t=M.marginTop,this.arrAdv.push(new E({x:e,y:t,letter:this.adv_letters[n]}))},updateAdv:function(){for(var e,t,i,n,A=0;A<this.arrAdv.length;A++)for((e=this.arrAdv[A]).y<40?e.y+=M.moveY:(M.moveY=0,M.updateAdvFrameCounter=5,0==M.shakeAdv--&&(M.moveX=0,M.updateAdvFrameCounter=33,v.play())),i=0,n=e.blocks.length;i<n;i++)(t=e.blocks[i]).x+=M.moveX,t.y+=M.moveY;M.moveX*=-1},drawAdv:function(){var e,t,i,n,A;for(n=0,b=this.arrAdv.length;n<b;n++)for(A=0,i=(e=this.arrAdv[n]).blocks.length;A<i;A++)t=e.blocks[A],a.drawImage(s,t.sprite.tiles[t.tileId].x,t.sprite.tiles[t.tileId].y,t.sprite.width,t.sprite.height,t.x,t.y,t.sprite.width*e.scale,t.sprite.height*e.scale)},advLoop:function(){M.advFrameCounter==M.updateAdvFrameCounter?(M.updateAdv(),M.advFrameCounter=0):M.advFrameCounter++,this.drawAdv()}},N={arrBunker:[],nBunkers:4,init:function(){var e,t;this.arrBunker=[];for(var i=0;i<this.nBunkers;i++)e=r.width/(2*this.nBunkers)-4*T.bunkerFull.width/2+i*(r.width/this.nBunkers),t=r.height-180,this.arrBunker.push(new L({x:e,y:t}))},drawBunkers:function(){for(var e,t,i=0,n=this.arrBunker.length;i<n;i++)for(var A=0,r=(e=this.arrBunker[i]).blocks.length;A<r;A++)t=e.blocks[A],a.drawImage(s,t.sprite.tiles[t.tileId].x,t.sprite.tiles[t.tileId].y,t.sprite.width,t.sprite.height,t.x,t.y,t.sprite.width,t.sprite.height)}},O={nLives:3,lineY:0,lineHeight:5,lineInterrupts:[],lineImageData:null,init:function(){this.nLives=3,this.lineInterrupts=[],this.lineImageData=null,this.lineY=r.height-50;new z.textArea({cls:"field livesField",childs:[z.writeText({cls:"text livesText",id:"livesPlayer1",text:this.nLives})],appendTo:w,left:"0px",bottom:"0px"})},sortInterrupts:function(e,t){return e-t},drawLine:function(){a.fillStyle="rgba(0,255,0,255)";var e=0,t=r.width;O.lineInterrupts.sort(this.sortInterrupts);for(var i=0;i<this.lineInterrupts.length;i++)t=this.lineInterrupts[i]-e,a.fillRect(e,this.lineY,t,this.lineHeight),e=this.lineInterrupts[i]+T.alienBullet.width;t=r.width-e,a.fillRect(e,this.lineY,t,this.lineHeight)},drawLives:function(){var e,t;this.drawLine();for(var i=0;i<this.nLives;i++)t=r.height-T.cannon.height-7,e=T.cannon.width+i*(1.5*T.cannon.width),c=new C({sprite:T.cannon,x:r.width/2-T.cannon.width/2,y:r.height-T.cannon.height}),a.drawImage(s,T.cannon.tiles[0].x,T.cannon.tiles[0].y,T.cannon.width,T.cannon.height,e,t,T.cannon.width,T.cannon.height);h||z.updateText("#livesPlayer1",this.nLives)}},z={textArea:function(e){if(this.div=document.createElement("div"),e.id&&(this.div.id=e.id),this.div.className=e.cls,this.childs=e.childs,this.appendTo=e.appendTo,e.width&&(this.div.style.width=e.width+"px"),this.appendTo.appendChild(this.div),this.childs)for(var t=0,i=this.childs.length;t<i;t++)this.div.appendChild(this.childs[t]);return this.set=function(e){var t,i,n,A;if(e.position)switch(e.position){case"centerBottom":t=r.width/2-this.div.offsetWidth/2+"px",A="0px";break;case"centerHV":t=r.width/2-this.div.offsetWidth/2+"px",i=r.height/2-this.div.offsetHeight/2+"px";break;case"centerH":t=r.width/2-this.div.offsetWidth/2+"px"}e.left&&(t=e.left),e.top&&(i=e.top),e.bottom&&(A=e.bottom),e.right&&(n=e.right),this.div.style.left=t,this.div.style.top=i,this.div.style.bottom=A,this.div.style.right=n},this.set(e),this},removeTextArea:function(e){w.removeChild(document.querySelector("#"+e))},writeText:function(e){var t=document.createElement("p");return t.className=e.cls,e.id&&(t.id=e.id),e.text&&t.appendChild(document.createTextNode(e.text)),e.innerhtml&&(t.innerHTML=e.innerhtml),e.onclick&&(t.onclick=e.onclick),t},writeAnything:function(e){if(!e.type)return!1;var t=document.createElement(e.type);if(e.cls&&(t.className=e.cls),e.attributes&&e.attributes.length)for(var i=0;i<e.attributes.length;i++)t.setAttribute(e.attributes[i][0],e.attributes[i][1]);return e.id&&(t.id=e.id),e.text&&t.appendChild(document.createTextNode(e.text)),e.innerhtml&&(t.innerHTML=e.innerhtml),e.onclick&&(t.onclick=e.onclick),t},typewrite:function(e){for(var t,i,n=document.querySelectorAll(e),A=0;A<n.length;A++){(t=n[A]).className+=" typewrite ",i=t.textContent.length;var s=document.documentElement.appendChild(document.createElement("style")),r=t.id+"_typing {from {width: 0} to {width: "+i+"em}}";CSSRule.WEBKIT_KEYFRAMES_RULE?s.sheet.insertRule("@-webkit-keyframes "+r,0):CSSRule.MOZ_KEYFRAMES_RULE?s.sheet.insertRule("@-moz-keyframes "+r,0):CSSRule.KEYFRAMES_RULE&&s.sheet.insertRule("@keyframes "+r,0),r="{width: auto;}",s.sheet.insertRule("#"+t.id+".end"+r,0),t.style.animation=t.id+"_typing 2s steps("+i+", end) "+2*A+"s",t.style["-webkit-animation"]=t.id+"_typing 2s steps("+i+", end) "+2*A+"s",t.style.MozAnimation=t.id+"_typing 2s steps("+i+", end) "+2*A+"s",t.style["-ms-animation"]=t.id+"_typing 2s steps("+i+", end) "+2*A+"s",t.className+=" startTypewrite ",t.removeEventListener("animationend",this.typewrite_cb,!1),t.removeEventListener("webkitAnimationEnd",this.typewrite_cb,!1),t.addEventListener("animationend",this.typewrite_cb,!1),t.addEventListener("webkitAnimationEnd",this.typewrite_cb,!1)}return 2*n.length},typewrite_cb:function(e){e.target.className+=" end "},changeTextColor:function(e,t){var n,A=i(e);if(!t){for(t="#",n=0;n<3;n++)t+="0123456789ABCDEF".substr(Math.random()*"0123456789ABCDEF".length,1)}A&&(A.style.color=t)},updateText:function(e,t,n){i(e).innerHTML=null==n?t:z.pad(t,5,"0","L")},removeText:function(e){var t=i("#"+e);console.debug(t),t&&t.parentNode.removeChild(t)},pad:function(e,t,i,n){var A="";for(e=e.toString();A.length<t-e.length;)A+=i;switch(n){case"L":e=A+e;break;case"R":e+=A}return e}},G={left:37,right:39,fire:32},q=function(e){e||(e=window.event),W(e.keyCode,e.type)};function W(e,t){switch(e){case G.left:R.moveCannon="keyup"==t?"N":"L";break;case G.right:R.moveCannon="keyup"==t?"N":"R";break;case G.fire:R.cannonFire="keyup"!=t}}var H=function(){(r=document.createElement("canvas")).tabIndex=0,a=r.getContext("2d"),w.appendChild(r)},X=function(){r.width=w.offsetWidth,r.height=w.offsetHeight,a.fillRect(0,0,r.width,r.height)},j=function(e){if(!e)e=window.event;e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation(),V.game()},P={init:function(){var e=document.createElement("div"),t=document.createElement("div"),i=document.createElement("div"),n=document.createElement("div"),A=document.createElement("div"),s=document.createElement("div");mobile_shot_right=document.createElement("div"),mobile_shot_right_txt=document.createElement("div"),w.appendChild(e),w.appendChild(t),w.appendChild(i),w.appendChild(n),w.appendChild(A),w.appendChild(s),w.appendChild(mobile_shot_right),w.appendChild(mobile_shot_right_txt),e.className="mobile-button mobile-left",t.className="mobile-button mobile-left mobile-text",t.id="move-left",t.appendChild(document.createTextNode("<")),i.className="mobile-button mobile-right",n.className="mobile-button mobile-right mobile-text",n.id="move-right",n.appendChild(document.createTextNode(">")),A.className="mobile-button mobile-shot-left",s.className="mobile-button mobile-text mobile-shot-text-left",s.id="shot-L",s.appendChild(document.createTextNode("shot")),mobile_shot_right.className="mobile-button mobile-shot-right",mobile_shot_right_txt.className="mobile-button mobile-text mobile-shot-text-right",mobile_shot_right_txt.id="shot-R",mobile_shot_right_txt.appendChild(document.createTextNode("shot")),window.removeEventListener("touchstart",P.startTouch,!0),window.removeEventListener("touchend",P.stopTouch,!0),window.addEventListener("touchstart",P.startTouch,!0),window.addEventListener("touchend",P.stopTouch,!0)},startTouch:function(e){e||(e=window.event);var t=e.target.id;"right"==t||"move-right"==t?R.moveCannon="R":"left"==t||"move-left"==t?R.moveCannon="L":"fire"!=t&&"shot-L"!=t&&"shot-R"!=t||(R.cannonFire=!0)},stopTouch:function(e){R.moveCannon="N",R.cannonFire=!1}},Q=function(){K(),(s=new Image).onload=function(){H(),X(),o=0,h=!1,D.init(),O.init(),R.init(),Y.init(),N.init(),M.init();new z.textArea({cls:"field scoreField",childs:[z.writeText({innerhtml:'<span class="text scoreText">score</span> <span class="text scoreText" id="scorePlayer1">00000</span>'})],appendTo:w,left:"0px",top:"0px"});var e=w;"ontouchstart"in window&&P.init(),function t(i){a.clearRect(0,0,r.width,r.height),D.drawStars(),R.drawCannon(),M.advLoop(),Y.drawAliens(),N.drawBunkers(),R.drawCannonBullet(),Y.drawAlienBullet(),z.updateText("#scorePlayer1",R.score,!0),O.drawLives(),h&&V.gameOver(),0==O.nLives&&(h=!0),d=requestAnimationFrame(t,e)}()},s.src=B},K=function(){for(;w.hasChildNodes();)w.removeChild(w.lastChild)},V={intro:function(){cancelAnimationFrame(d),function(){K(),H(),X(),D.init();var e=m?"best score: "+m.name+" - "+m.score:"";new z.textArea({cls:"field",childs:[z.writeText({id:"play",cls:"text clickText menuText",innerhtml:"play",onclick:j}),z.writeText({id:"AdvInvadersText",cls:"text",text:"space invaders"}),z.writeText({id:"bestScore",cls:"text clickText bestScore",text:e})],appendTo:w,width:r.width,position:"centerH",top:"20%"});new z.textArea({cls:"field scoreAdvanceTableField",childs:[z.writeText({cls:"text scoreAdvanceText",text:"*score advance table*"}),z.writeText({innerhtml:"<ul id='scoreAdvanceTable'><li><span><span id='span_score_adv'></span></span><p id='score_adv' class='text scoreAdvanceText'>= ? mystery</p></li><li class='li-right'><span><span id='span_score_mystery'></span></span><p id='score_mystery' class='text scoreAdvanceText'>= ? mystery</p></li><li class='li-right'><span><span id='span_score_30'></span></span><p id='score_30' class='text scoreAdvanceText'>= 30 points</p></li><li class='li-right'><span><span id='span_score_20'></span></span><p id='score_20' class='text scoreAdvanceText'>= 20 points</p></li><li class='li-right'><span><span id='span_score_10'></span></span><p id='score_10' class='text scoreAdvanceText'>= 10 points</p></li></ul>"})],appendTo:w,width:450,position:"centerH",top:"50%"}),new z.textArea({cls:"field",childs:[z.writeText({id:"instructionsLink",cls:"text clickText smallText",text:"instructions",onclick:V.instructions})],appendTo:w,width:400,position:"centerBottom"}),i("#span_score_adv").style.background="url('"+B+"') -4px -396px no-repeat",i("#span_score_mystery").style.background="url('"+B+"') -4px -122px no-repeat",i("#span_score_30").style.background="url('"+B+"') -4px -4px no-repeat",i("#span_score_20").style.background="url('"+B+"') -4px -40px no-repeat",i("#span_score_10").style.background="url('"+B+"') -4px -76px no-repeat";z.typewrite("#score_adv, #score_10, #score_20, #score_30, #score_mystery");var t=w;!function e(i){a.clearRect(0,0,r.width,r.height),D.drawStars(),z.changeTextColor("#play"),d=requestAnimationFrame(e,t)}()}()},instructions:function(){new z.textArea({id:"divInstructions",cls:"field instructionsFieldFrame",childs:[z.writeText({cls:"text instructionsText",innerhtml:"<ol><li>press 'play' to start</li><li>left/right keys to move</li><li>'spacebar' to shot</li></ol>"}),z.writeText({cls:"text clickText menuText",text:"close",onclick:function(){z.removeTextArea("divInstructions")}})],appendTo:w,position:"centerHV"})},game:function(){cancelAnimationFrame(d),Q()},gameOver:function(){cancelAnimationFrame(d),function(){if(!i("#divGameOver")){var e=[z.writeText({id:"gameOver",cls:"text menuHeaderText",text:"game over"}),z.writeText({id:"playAgain",cls:"text clickText menuText",text:"play again",onclick:j})];e.push(z.writeText({id:"tweetScore",cls:"text clickText",innerhtml:"<a target='blank' href='https://twitter.com/intent/tweet?original_referer=http://matteopiazza.org&text=Play%20Advertise%20Invaders%20on%20matteopiazza.org!%20My%20score:%20"+R.score+"!&tw_p=tweetbutton'>tweet your score</a>"})),new z.textArea({id:"divGameOver",cls:"field menuFieldFrame",childs:e,appendTo:w,position:"centerHV"})}}()},scoreSubmitted:function(){new z.textArea({id:"divScoreSubmitted",cls:"field submittedFieldFrame",childs:[z.writeText({cls:"text submittedText",text:"Score saved!"}),z.writeText({cls:"text clickText menuText",text:"close",onclick:function(){z.removeTextArea("divScoreSubmitted"),z.removeText("nameLabel"),z.removeText("nameInput"),z.removeText("scoreSubmitButton")}})],appendTo:w,position:"centerHV"})}};window.addEventListener("keydown",function(e){e||(e=window.event),[32].indexOf(e.keyCode)>-1&&e.preventDefault()},!1),window.removeEventListener("keydown",q,!0),window.removeEventListener("keyup",q,!0),window.removeEventListener("resize",X,!0),window.addEventListener("keydown",q,!0),window.addEventListener("keyup",q,!0),window.addEventListener("resize",X,!0),JYI.config({inputHandler:function(e){W(G[e.command],"key"+e.type)},wsAddress:"ws://localhost:8000"}),V.intro()};window.WIinit=function(){e("game",null)}}();